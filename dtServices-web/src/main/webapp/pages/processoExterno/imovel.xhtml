<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:p="http://primefaces.org/ui" xmlns:m="http://www.maerlin.com/jsf"
	xmlns:cat="http://java.sun.com/jsf/composite/component"
	xmlns:pe="http://primefaces.org/ui/extensions">

<p:fieldset legend="#{bundle.menu_cadastro_imovel}" toggleable="true"
	toggleSpeed="500">

	<h:panelGrid columns="2" id="endereco">
		<p:outputLabel value="#{bundle.default_field_name}" />
		<p:inputText size="60" label="#{bundle.imovel_field_inquilino}"
			value="#{processoExternoEditMB.processoExterno.imovel.inquilino}"
			required="true"
			validatorMessage="#{bundle.imovel_msg_invalidInquilino}">
		</p:inputText>
		<p:outputLabel value="#{bundle.imovel_field_crp}" />
		<p:inputText size="60" label="#{bundle.imovel_field_crp}"
			value="#{processoExternoEditMB.processoExterno.imovel.crp}"
			required="true"
			validatorMessage="#{bundle.imovel_msg_invalidCrp}">
		</p:inputText>
		<p:outputLabel value="#{bundle.endereco_field_ruaPorta}" />
		<h:panelGrid columns="2">
			<p:inputText id="ruaPorta" size="60"
				label="#{bundle.endereco_field_ruaPorta}"
				value="#{processoExternoEditMB.processoExterno.imovel.ruaPorta}"
				required="true"
				validatorMessage="#{bundle.imovel_msg_invalidEndereco}">
			</p:inputText>
			<p:commandButton value="Geocode" icon="ui-icon-search"
				onclick="geocode( $( '#concelho_label' ).html() + ' ' + $( '#ruaPorta' ).val() )"
				type="button" />
		</h:panelGrid>

		<p:outputLabel value="#{bundle.endereco_field_complemento}" />
		<p:inputText id="complemento" size="60"
			label="#{bundle.endereco_field_complemento}"
			value="#{processoExternoEditMB.processoExterno.imovel.complemento}"
			required="true">
		</p:inputText>

		<p:outputLabel value="#{bundle.endereco_field_cp}" />
		<h:panelGrid columns="2">
			<p:autoComplete id="cp" value="#{processoExternoEditMB.processoExterno.imovel.codigoPostal}"
				completeMethod="#{enderecoMB.search}" var="end"
				converter="enderecoConverter" itemLabel="#{end}"
				itemValue="#{end.id}" forceSelection="true" required="true">
				<p:ajax event="itemSelect"
					listener="#{processoExternoEditMB.onEnderecoSelect}"
					update="ruaPorta,complemento,cp,concelho,distrito" />
				<p:column style="width:10%">
					<h:outputText value="#{end.codigoPostal}" />
				</p:column>

				<p:column>
					<h:outputText value="#{end.ruaPorta}" />
				</p:column>

				<p:column>
					<h:outputText value="#{end.complemento}" />
				</p:column>

				<p:column>
					<h:outputText value="#{end.concelho.nome}" />
				</p:column>

				<p:column>
					<h:outputText value="#{end.distrito.nome}" />
				</p:column>
			</p:autoComplete>
			<p:commandButton value="Geocode" icon="ui-icon-search"
				onclick="geocode( $( '#cp_input' ).val() )" type="button" />
		</h:panelGrid>

		<p:outputLabel value="#{bundle.endereco_field_concelho}" />
		<p:selectOneMenu id="concelho"
			value="#{processoExternoEditMB.processoExterno.imovel.concelho.id}"
			style="width:125px" required="true"
			label="#{bundle.endereco_field_concelho}">
			<f:selectItems
				value="#{enderecoMB.getConcelhos(processoExternoEditMB.processoExterno.imovel.distrito)}"
				var="concelho" itemValue="#{concelho.id}"
				itemLabel="#{concelho.nome}" />
		</p:selectOneMenu>

		<p:outputLabel value="#{bundle.endereco_field_distrito}" />
		<p:selectOneMenu id="distrito"
			value="#{processoExternoEditMB.processoExterno.imovel.distrito.id}"
			style="width:125px" required="true"
			label="#{bundle.endereco_field_distrito}">
			<f:selectItems value="#{enderecoMB.distritos}" var="distrito"
				itemValue="#{distrito.id}" itemLabel="#{distrito.nome}" />
		</p:selectOneMenu>

		<p:outputLabel value="#{bundle.endereco_field_latitude}" />
		<p:inputText id="lat" size="30"
			label="#{bundle.endereco_field_latitude}"
			value="#{processoExternoEditMB.processoExterno.imovel.latitude}">
		</p:inputText>

		<p:outputLabel value="#{bundle.endereco_field_longitude}" />
		<p:inputText id="lng" size="30"
			label="#{bundle.endereco_field_longitude}"
			value="#{processoExternoEditMB.processoExterno.imovel.longitude}">
		</p:inputText>
		<p:commandButton id="btn" type="button" icon="ui-icon-pin-s"
			value="Show Map" onclick="geocodeReverse();" />

	</h:panelGrid>
	<p:dialog id="gmapDialog" widgetVar="gmapDlg" width="800" height="600"
		resizable="false" modal="true" closeOnEscape="true" closable="true"
		header="#{bundle.imovel_msg_chooseAPoint}">
		<p:panelGrid style="width: 100%" id="gmapPnl">
			<p:row>
				<p:column colspan="2">
					<p:gmap id="geoGmap" widgetVar="geoGmap"
						center="#{processoExternoEditMB.centerGeoMap}" type="ROADMAP"
						zoom="#{processoExternoEditMB.zoomLevel}"
						model="#{processoExternoEditMB.geoModel}" draggable="true"
						style="width:100%;height:500px" fitBounds="true"
						mapTypeControl="true" navigationControl="true" streetView="true">
						<p:ajax event="geocode"
							listener="#{processoExternoEditMB.onGeocode}"
							update="lat,lng,gmapPnl,gmapDialogShow" />
						<p:ajax event="pointSelect"
							listener="#{processoExternoEditMB.onPointSelect}"
							update="lat,lng,gmapPnl,gmapDialogShow" />
						<p:ajax event="overlaySelect"
							listener="#{processoExternoEditMB.onMarkerSelect}"
							update="lat,lng,gmapPnl,gmapDialogShow" />
						<p:ajax event="stateChange" listener="#{processoExternoEditMB.onStateChange}" />
					</p:gmap>
				</p:column>
			</p:row>
			<p:row>
				<p:column>
					<p:outputLabel value="#{bundle.endereco_field_latitude}" />
				</p:column>
				<p:column>
					<p:inputText id="lat1" size="30"
						label="#{bundle.endereco_field_latitude}"
						value="#{processoExternoEditMB.processoExterno.imovel.latitude}">
					</p:inputText>
				</p:column>
			</p:row>
			<p:row>
				<p:column>
					<p:outputLabel value="#{bundle.endereco_field_longitude}" />
				</p:column>
				<p:column>
					<p:inputText id="lng1" size="30"
						label="#{bundle.endereco_field_longitude}"
						value="#{processoExternoEditMB.processoExterno.imovel.longitude}">
					</p:inputText>
				</p:column>
			</p:row>
		</p:panelGrid>
	</p:dialog>
	<p:dialog id="gmapDialogShow" widgetVar="gmapShowDlg" width="800" height="600" resizable="false" modal="true" closeOnEscape="true"
		closable="true" header="#{bundle.imovel_msg_showPoint}">
		<p:gmap id="geoGmapShow" widgetVar="geoGmapShow"
			center="#{processoExternoEditMB.centerGeoMap}" type="ROADMAP"
			zoom="#{processoExternoEditMB.zoomLevel}"
			model="#{processoExternoEditMB.geoModel}" draggable="true"
			style="width:100%;height:600px" mapTypeControl="true"
			navigationControl="true" streetView="true">
		</p:gmap>
	</p:dialog>
</p:fieldset>
</html>
